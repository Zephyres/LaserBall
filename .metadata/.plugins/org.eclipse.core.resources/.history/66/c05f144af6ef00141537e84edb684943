package entity;

import org.newdawn.slick.GameContainer;
import org.newdawn.slick.Image;
import org.newdawn.slick.Input;
import org.newdawn.slick.SlickException;
import org.newdawn.slick.state.StateBasedGame;

import utility.Geometry;
import utility.ReferenceFrame;

public class Player extends Entity {
	private float ax, ay, vx, vy;
	
	public Player() throws SlickException {
		Image i = new Image("images/player.png").getScaledCopy(0.35f);
		
		setImage(i);
		ax = 0.1f;
		ay = 0.1f;
	}

	@Override
	public void update(GameContainer gc, StateBasedGame gs, int d)
			throws SlickException {
		Input in = gc.getInput();
		
		float mx = in.getMouseX();
		float my = in.getMouseY();
		
		turnTowards(mx, my);
		shootProjectile(in);
		movePlayer(in);
	}
	
	public void movePlayer(Input in) {
		if(getX() < getWidth() / 2 || getX() > 1920 - getWidth() / 2) {
			vx = 0;
			
			if(getX() < getWidth() / 2)
				setX(getWidth() / 2);
			if(getX() > 1920 - getWidth() / 2)
				setX(1920 - getWidth() / 2);
		}
		if(getY() < getHeight() / 2 || getY() > 1080 - getHeight() / 2) {
			vy = 0;
		}
		
		if(in.isKeyDown(Input.KEY_W) && getY() >= getHeight() / 2)
			vy -= ay;
		if(in.isKeyDown(Input.KEY_A) && getX() >= getWidth() / 2)
			vx -= ax;
		if(in.isKeyDown(Input.KEY_S))
			vy += ay;
		if(in.isKeyDown(Input.KEY_D) && getX() <= 1920 - getWidth() / 2)
			vx += ax;
		
		changeX(vx);
		changeY(vy);
	}
	
	public void shootProjectile(Input in) throws SlickException {
		float h = getHeight() * 0.75f;
		float dx = Geometry.getXComponent(h, getRotation());
		float dy = Geometry.getYComponent(h, getRotation());
		
		if(in.isKeyPressed(Input.KEY_SPACE))
			getWorld().addObject(new LaserWave(10, getRotation(), 5), getX() + dx, getY() + dy);
	}
}
